<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Edit Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .preview-item { 
            position: relative; 
            width: 120px; 
            height: 120px; 
            border: 2px solid #e3f2fd; 
            border-radius: 8px; 
            overflow: hidden; 
            display: inline-block; 
            margin: 5px; 
        }
        .preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .image-label { 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: rgba(33, 150, 243, 0.9); 
            color: white; 
            padding: 4px 8px; 
            font-size: 0.75rem; 
            text-align: center; 
        }
        .remove-existing-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <h1>Simple Edit Test</h1>
    
    <div id="imagePreview"></div>
    
    <button onclick="testDisplayImages()">Test Display Images</button>
    <button onclick="loadAndTestProduct()">Load Product & Test</button>
    
    <script>
        // Store existing images globally
        window.existingImages = [];
        
        // Function to display existing images in edit mode
        function displayExistingImages(images) {
            console.log('displayExistingImages called with:', images);
            const imagePreview = document.getElementById('imagePreview');
            if (!imagePreview) {
                console.error('imagePreview not found');
                return;
            }
            
            // Store existing images globally
            window.existingImages = [...images];
            console.log('Stored existing images:', window.existingImages);
            
            // Clear existing preview
            imagePreview.innerHTML = '';
            
            // Create container for existing images
            const existingContainer = document.createElement('div');
            existingContainer.className = 'existing-images-container';
            existingContainer.id = 'existingImagesContainer';
            
            updateExistingImagesDisplay();
            
            imagePreview.appendChild(existingContainer);
            console.log('Containers added to imagePreview');
        }
        
        // Function to update existing images display
        function updateExistingImagesDisplay() {
            console.log('updateExistingImagesDisplay called');
            const existingContainer = document.getElementById('existingImagesContainer');
            if (!existingContainer) {
                console.error('existingImagesContainer not found');
                return;
            }
            
            existingContainer.innerHTML = '';
            console.log('Processing existing images:', window.existingImages);
            
            window.existingImages.forEach((imageSrc, index) => {
                console.log(`Creating preview for image ${index}:`, imageSrc);
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item existing-image';
                previewItem.innerHTML = `
                    <img src="${imageSrc}" alt="Existing Image ${index + 1}">
                    <div class="remove-existing-image" data-index="${index}">
                        <i class="fas fa-times">X</i>
                    </div>
                    <div class="image-label">Existing Image</div>
                `;
                
                // Add click event to remove existing image
                const removeBtn = previewItem.querySelector('.remove-existing-image');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeExistingImage(index);
                });
                
                existingContainer.appendChild(previewItem);
            });
            
            console.log('Images added to container, total children:', existingContainer.children.length);
        }
        
        // Function to remove existing image
        function removeExistingImage(index) {
            window.existingImages.splice(index, 1);
            updateExistingImagesDisplay();
        }
        
        // Test function
        function testDisplayImages() {
            const testImages = [
                'https://via.placeholder.com/120/ff0000/ffffff?text=Test1',
                'https://via.placeholder.com/120/00ff00/ffffff?text=Test2'
            ];
            displayExistingImages(testImages);
        }
        
        // Load actual product and test
        async function loadAndTestProduct() {
            try {
                const response = await fetch('data/products.json');
                const products = await response.json();
                console.log('Products loaded:', products);
                
                const product = products.find(p => p.id === '1762328892768');
                if (product) {
                    console.log('Product found:', product);
                    console.log('Product images:', product.images);
                    if (product.images && product.images.length > 0) {
                        displayExistingImages(product.images);
                    } else {
                        console.log('No images in product');
                    }
                } else {
                    console.log('Product not found');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>